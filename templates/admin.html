{% extends "layout.html" %}
{% block content %}
<div class="admin-head" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
  <div>
    <h2>Administration Dashboard</h2>
    <p class="muted">Comprehensive analytics and management tools</p>
  </div>
  <div class="admin-actions">
    <a href="{{ url_for('admin_users') }}" class="btn-small">Manage Users</a>
    <a href="{{ url_for('admin_properties') }}" class="btn-small">Manage Properties</a>
    <a href="{{ url_for('reports') }}" class="btn-small">Reports</a>
  </div>
</div>

<!-- QUICK STATS -->
<div class="row-cards">
  <div class="card card-compact text-center">
    <div class="stat-number">{{ totals.users }}</div>
    <div class="stat-label">Total Users</div>
  </div>
  <div class="card card-compact text-center">
    <div class="stat-number">{{ totals.properties }}</div>
    <div class="stat-label">Properties</div>
  </div>
  <div class="card card-compact text-center">
    <div class="stat-number">{{ totals.sales }}</div>
    <div class="stat-label">Total Sales</div>
  </div>
  <div class="card card-compact text-center">
    <div class="stat-number">
      {% if top_agents and top_agents[0] and top_agents[0].sales_count %}
        {{ top_agents[0].sales_count }}
      {% else %}
        0
      {% endif %}
    </div>
    <div class="stat-label">Top Agent Sales</div>
  </div>
</div>

<!-- TOP AGENTS -->
<div class="card mb-30">
  <h4>üèÜ Top Performing Agents</h4>
  <div class="table-responsive mt-20">
    <table class="table">
      <thead>
        <tr>
          <th>Rank</th>
          <th>Agent Name</th>
          <th>Sales Count</th>
          <th>Total Sales Value</th>
          <th>Avg. Sale</th>
        </tr>
      </thead>
      <tbody>
        {% for agent in top_agents %}
        <tr>
          <td>
            <span class="leaderboard-rank">{{ loop.index }}</span>
          </td>
          <td>
            <strong>{{ agent.display_name }}</strong>
          </td>
          <td>{{ agent.sales_count or 0 }}</td>
          <td>${{ agent.total_sales|format_price if agent.total_sales else '0' }}</td>
          <td>
            {% if agent.sales_count and agent.sales_count > 0 and agent.total_sales %}
              ${{ (agent.total_sales / agent.sales_count)|round|int|format_price }}
            {% else %}
              $0
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- TOP LOCATIONS -->
<div class="card">
  <h4>üìç Top Property Locations</h4>
  <div class="table-responsive mt-20">
    <table class="table">
      <thead>
        <tr>
          <th>City</th>
          <th>Properties</th>
          <th>Avg. Price</th>
        </tr>
      </thead>
      <tbody>
        {% for loc in top_locations %}
        <tr>
          <td><strong>{{ loc.city or 'Unknown' }}</strong></td>
          <td>{{ loc.cnt }}</td>
          <td>
            {% if loc.avg_price %}
              ${{ loc.avg_price|round|int|format_price }}
            {% else %}
              N/A
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- QUICK ACTIONS -->
<div class="card mt-30">
  <h4>‚ö° Quick Actions</h4>
  <div class="row-cards mt-20">
    <div class="card card-compact">
      <h5>üë• User Management</h5>
      <p>View and manage all system users</p>
      <a href="{{ url_for('admin_users') }}" class="btn-small mt-10">Manage Users</a>
    </div>
    <div class="card card-compact">
      <h5>üè† Property Management</h5>
      <p>Manage all listed properties</p>
      <a href="{{ url_for('admin_properties') }}" class="btn-small mt-10">Manage Properties</a>
    </div>
    <div class="card card-compact">
      <h5>üìä Advanced Reports</h5>
      <p>View detailed analytics and reports</p>
      <a href="{{ url_for('reports') }}" class="btn-small mt-10">View Reports</a>
    </div>
  </div>
</div>

<style>
.leaderboard-rank {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 28px;
  height: 28px;
  background: var(--accent);
  color: white;
  border-radius: 50%;
  font-weight: 600;
  margin-right: 12px;
}
.row-cards {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
  margin: 20px 0;
}
.card-compact {
  padding: 20px;
}
.stat-number {
  font-size: 32px;
  font-weight: 700;
  color: var(--accent2);
  margin-bottom: 8px;
}
.stat-label {
  color: var(--text-muted);
  font-size: 14px;
}
.table-responsive {
  overflow-x: auto;
}
.table {
  width: 100%;
  border-collapse: collapse;
}
.table th {
  background: var(--bg2);
  padding: 12px;
  text-align: left;
  font-weight: 600;
}
.table td {
  padding: 12px;
  border-bottom: 1px solid rgba(255,255,255,0.1);
}
.table tr:hover {
  background: rgba(255,255,255,0.05);
}
</style>
{% endblock %}